/*! Protected Content - v1.1.0
 * https://premium.wpmudev.org/project/membership/
 * Copyright (c) 2014; * Licensed GPLv2+ */
window.ms_init=window.ms_init||{},jQuery(function(){function e(e){if(void 0!==e&&void 0!==window.ms_init[e]){if(!0===window.ms_init._done[e])return!1;window.ms_init._done[e]=!0,window.ms_init[e]()}}var t;if(window.ms_init._done=window.ms_init._done||{},void 0!==window.ms_data&&void 0!==ms_data.ms_init){if(ms_data.ms_init instanceof Array)for(t=0;ms_data.ms_init.length>t;t+=1)e(ms_data.ms_init[t]);else e(ms_data.ms_init);ms_data.ms_init=[]}}),window.ms_functions={dp_config:{dateFormat:"yy-mm-dd",dayNamesMin:["Sun","Mon","Tue","Wed","Thy","Fri","Sat"],custom_class:"wpmui-datepicker"},chosen_options:{minimumResultsForSearch:6,dropdownAutoWidth:!0,dropdownCssClass:"ms-select2",containerCssClass:"ms-select2"},init:function(e){var t=window.ms_functions;jQuery(".ms-wrap select:not(.manual-init), .ms-wrap .chosen-select",e).select2(t.chosen_options),jQuery(".wpmui-datepicker",e).ms_datepicker()},ajax_update:function(e){var t,i,n,r=jQuery(e),a=window.ms_functions,s=r;r.hasClass("ms-processing")||(s.parents(".wpmui-radio-wrapper").length?s=s.parents(".wpmui-radio-wrapper").first():s.parents(".wpmui-radio-slider-wrapper").length?s=s.parents(".wpmui-radio-slider-wrapper").first():s.parents(".wpmui-input-wrapper").length?s=s.parents(".wpmui-input-wrapper").first():s.parents("label").length&&(s=s.parents("label").first()),s.addClass("wpmui-loading"),n=a.ajax_show_indicator(r),t=r.data("ajax"),r.is(":checkbox")?t.value=r.prop("checked"):(i=r.val(),i instanceof Array||i instanceof Object||null===i?t.values=i:t.value=i),"function"==typeof r.data("before_ajax")&&(t=r.data("before_ajax")(t,r)),jQuery.post(window.ajaxurl,t,function(e){var i=a.ajax_error(e,n);s.removeClass("wpmui-loading"),n.removeClass("ms-processing"),r.trigger("ms-ajax-updated",[t,e,i])}))},radio_slider_ajax_update:function(e){var t,i,n,r,a,s=jQuery(e),o=window.ms_functions;s.hasClass("ms-processing")||s.attr("readonly")||(i=o.ajax_show_indicator(s),s.addClass("ms-processing wpmui-loading"),s.toggleClass("on"),s.parent().toggleClass("on"),s.trigger("change"),n=s.children(".wpmui-toggle"),t=n.data("ajax"),r=n.data("states"),null!=t&&(a=s.hasClass("on"),t.value=void 0!==r.active&&a?r.active:void 0===r.inactive||a?a:r.inactive,"function"==typeof s.data("before_ajax")&&(t=s.data("before_ajax")(t,s)),jQuery.post(window.ajaxurl,t,function(e){var n=o.ajax_error(e,i);n&&s.togglesClass("on"),i.removeClass("ms-processing"),s.removeClass("ms-processing wpmui-loading"),s.children("input").val(s.hasClass("on")),t.response=e,s.trigger("wpmui-radio-slider-updated",[t,n])})))},dynamic_form_submit:function(e,t){var i,n,r,a,s,o,u=window.ms_functions,l=jQuery(t),d=l.serializeArray(),c={};for(e.preventDefault(),i=0;d.length>i;i+=1)r=d[i].name,n=d[i].value,void 0===c[r]?c[r]=n:(!c[r]instanceof Array&&(c[r]=[c[r]]),c[r].push(n));return c.action="ms_submit",o=l.parents(".wpmui-wnd"),a=o.length,a?o.addClass("wpmui-loading"):s=u.ajax_show_indicator(l),jQuery(document).trigger("ms-ajax-form-send",[l,c,a,s]),jQuery.post(window.ajaxurl,c,function(e){var t=u.ajax_error(e,s);o.length&&o.removeClass("wpmui-loading"),t||a&&u.close_dialogs(),jQuery(document).trigger("ms-ajax-form-done",[l,e,t,c,a,s])}),!1},ajax_error:function(e,t){var i=0,n=[],r="",a=window.ms_functions;return isNaN(e)?(n=e.split(":",2),isNaN(n[0])||(i=n[0]),void 0!==n[1]&&(r=n[1])):i=e,0>i?(t&&(t.removeClass("okay").addClass("error"),t.find(".err-code").text(r),a.ajax_hide_message(8e3,t)),!0):(t&&(t.removeClass("error").addClass("okay"),t.find(".err-code").text(""),a.ajax_hide_message(4e3,t)),!1)},ajax_show_indicator:function(e){var t;return window.ms_functions,t=e.nearest(".ms-save-text-wrapper"),null!==t.data("msg_timeout")&&(window.clearTimeout(t.data("msg_timeout")),t.data("msg_timeout",null)),t.addClass("ms-processing"),t.removeClass("error okay"),t},ajax_hide_message:function(e,t){var i;window.ms_functions,isNaN(e)&&(e=4e3),0>e&&(e=0),i=window.setTimeout(function(){var e=t;e.removeClass("error okay")},e),t.data("msg_timeout",i)},select_all:function(e){var t;e=jQuery(e)[0],document.selection?(t=document.body.createTextRange(),t.moveToElementText(e),t.select()):window.getSelection&&(t=document.createRange(),t.selectNode(e),window.getSelection().addRange(t))},toggle_box:function(e,t){var i=jQuery(t),n=i.closest(".ms-settings-box");return n.hasClass("static")?!1:(n.hasClass("closed")?n.removeClass("closed").addClass("open"):n.removeClass("open").addClass("closed"),void 0)},toggle_datepicker:function(e){var t=jQuery(e),i=t.closest(".wpmui-datepicker-wrapper").find(".wpmui-datepicker");i.datepicker("show")},tag_selector_add:function(e){var t=window.ms_functions,i=jQuery(this).closest(".wpmui-tag-selector-wrapper"),n=i.find("select.wpmui-tag-source"),r=i.find("select.wpmui-tag-data"),a=r.val()||[];n.val().length&&(a.push(n.val()),r.val(a).trigger("change"),n.val("").trigger("change"),t.tag_selector_refresh_source(e,this))},tag_selector_refresh_source:function(e,t){var i=0,n=null,r=jQuery(t).closest(".wpmui-tag-selector-wrapper"),a=r.find("select.wpmui-tag-source"),s=a.find("option"),o=r.find("select.wpmui-tag-data"),u=o.val()||[];for(i=0;s.length>i;i+=1)n=jQuery(s[i]),-1!==jQuery.inArray(n.val(),u)?n.prop("disabled",!0):n.prop("disabled",!1);a.trigger("change")},reload:function(){window.location.reload()},show_dialog:function(e){var t=jQuery(this),i=(window.ms_functions,{});return e.preventDefault(),i.action="ms_dialog",i.dialog=t.attr("data-ms-dialog"),jQuery(document).trigger("ms-load-dialog",[i]),jQuery.post(window.ajaxurl,i,function(e){var t,i=!1;try{i=jQuery.parseJSON(e)}catch(n){i=!1}i.title=i.title||"Dialog",i.height=i.height||100,i.content=i.content||"",t=wpmUi.popup().modal(!0).title(i.title).size(void 0,i.height).content(i.content).show()}),!1},close_dialogs:function(){var e,t=wpmUi.popups();for(e in t)t[e].close()}},jQuery.fn.ms_datepicker=function(e){var t=null,i=window.ms_functions,n=jQuery.extend(i.dp_config,e);return"function"==typeof n.beforeShow&&(t=n.beforeShow),n.beforeShow=function(e,i){void 0!==i&&void 0!==i.dpDiv&&jQuery(i.dpDiv).addClass(n.custom_class),null!==t&&t(e,i)},this.each(function(){jQuery(this).datepicker(n)})},jQuery(document).ready(function(){var e=window.ms_functions;jQuery("body").on("click",".wpmui-radio-slider",function(){e.radio_slider_ajax_update(this)}).on("click",".ms-settings-box .handlediv",function(t){e.toggle_box(t,this)}).on("click",".wpmui-datepicker-wrapper .wpmui-icon",function(){e.toggle_datepicker(this)}).on("select2-opening",".wpmui-tag-selector-wrapper .wpmui-tag-data",function(e){e.preventDefault()}).on("change",".wpmui-tag-selector-wrapper .wpmui-tag-data",function(t){e.tag_selector_refresh_source(t,this)}).on("click",".wpmui-tag-selector-wrapper .wpmui-tag-button",e.tag_selector_add).on("change","input.wpmui-ajax-update, select.wpmui-ajax-update, textarea.wpmui-ajax-update",function(){e.ajax_update(this)}).on("click","button.wpmui-ajax-update",function(){e.ajax_update(this)}).on("submit","form.wpmui-ajax-update",function(t){e.dynamic_form_submit(t,this)}).on("click","[data-ms-dialog]",e.show_dialog),jQuery(".ms-wrap").on("click","code",function(){e.select_all(this)}),e.init("body")}),jQuery(function(){jQuery(document).click(function(){function e(){var e=jQuery(this),t=e.attr("timestamp"),i=jQuery('.wpmui-tooltip-wrapper[timestamp="'+t+'"]').first();e.hide(),e.appendTo(jQuery(i))}jQuery(".wpmui-tooltip[timestamp]").each(e)}),jQuery(".wpmui-tooltip-button").click(function(){var e=jQuery(this),t=e.parents(".wpmui-tooltip"),i=jQuery(t).attr("timestamp"),n=jQuery('.wpmui-tooltip-wrapper[timestamp="'+i+'"]').first();jQuery(t).hide(),jQuery(t).appendTo(jQuery(n))}),jQuery(".wpmui-tooltip").click(function(e){e.stopPropagation()}),jQuery(".wpmui-tooltip-info").click(function(e){var t,i,n,r,a,s=jQuery(this);s.toggleClass("open"),s.hasClass("open")?(s.parents(".wpmui-tooltip-wrapper").attr("timestamp",e.timeStamp),e.stopPropagation(),a=s.siblings(".wpmui-tooltip"),a.attr("timestamp",e.timeStamp),r=s.offset(),a.appendTo("#wpcontent"),a.css({left:r.left+25,top:r.top-40}),a.fadeIn(300)):(t=s.parents(".wpmui-tooltip-wrapper"),i=jQuery(t).attr("timestamp"),n=jQuery('.wpmui-tooltip[timestamp="'+i+'"]').first(),jQuery(n).hide(),jQuery(n).appendTo(jQuery(t)))})}),window.ms_init.view_help=function(){function e(){var e=jQuery(this),t=e.parents(".ms-help-box").first(),i=t.find(".ms-help-details");i.toggle()}jQuery(".ms-help-toggle").click(e)},window.ms_init.view_member_date=function(){jQuery(".ms-date").ms_datepicker()},window.ms_init.view_member_list=function(){function e(){"membership"===jQuery("#search_options").val()?(jQuery("#membership_filter").show(),jQuery("#member-search").hide()):(jQuery("#membership_filter").hide(),jQuery("#member-search").show())}function t(){var e=jQuery("#new_member").val();return e.length?(jQuery("#form_add_member").submit(),void 0):!1}function i(){var e=jQuery("#new_member").val();e.length?jQuery("#add_member").removeClass("disabled"):jQuery("#add_member").addClass("disabled")}function n(){var e=jQuery("#view_membership"),t=parseInt(e.val()),i=e.data("ajax"),n=i.url+t;0>=t||(window.location=n)}var r=jQuery.extend({},window.ms_functions.chosen_options);jQuery("#search_options").change(e),e(),r.minimumResultsForSearch=0,r.placeholder=window.ms_data.lang.select_user,r.allowClear=!0,r.multiple=!0,r.minimumInputLength=1,r.closeOnSelect=!1,r.ajax={url:window.ajaxurl,dataType:"jsonp",cache:!0,quietMillis:500,data:function(e){return{filter:e,action:"get_users"}},results:function(e){return{results:e}}},jQuery("#new_member").select2(r).change(i),jQuery("#add_member").click(t),i(),jQuery("#view_membership").change(n)},window.ms_init.view_membership_choose_type=function(){var e=(jQuery(".ms-private-wrapper"),ms_data.ms_pointer);jQuery("#ms-choose-type-form").validate({onkeyup:!1,errorClass:"ms-validation-error",rules:{name:{required:!0}}}),jQuery("#private").change(function(){var e=jQuery(this),t=e.prop("checked"),i=jQuery('input[name="type"]'),n=i.filter(":checked").val();t?("simple"!==n&&"content_type"!==n&&i.filter('[value="simple"]').prop("checked",!0).trigger("click"),i.filter('[value="tier"]').prop("disabled",!0),i.filter('[value="dripped"]').prop("disabled",!0),jQuery(".wpmui-tier").addClass("ms-locked"),jQuery(".wpmui-dripped").addClass("ms-locked")):(i.filter('[value="tier"]').prop("disabled",!1),i.filter('[value="dripped"]').prop("disabled",!1),jQuery(".wpmui-tier").removeClass("ms-locked"),jQuery(".wpmui-dripped").removeClass("ms-locked"))}),jQuery('input[name="type"]').click(function(){var e=jQuery('input[name="type"]'),t=e.filter(":checked");e.closest(".wpmui-radio-input-wrapper").removeClass("active"),t.closest(".wpmui-radio-input-wrapper").addClass("active")}).first().trigger("click"),jQuery("#cancel").click(function(){var e=jQuery(this);e.on("ms-ajax-updated",function(){window.location=ms_data.initial_url}),ms_functions.ajax_update(e)}),e.hide_wizard_pointer||jQuery("#adminmenu li").find('a[href="admin.php?page=protected-content-setup"]').pointer({content:e.message,pointerClass:e.pointer_class,position:{edge:"left",align:"center"},buttons:function(e,t){var i=window.wpPointerL10n?window.wpPointerL10n.dismiss:"Dismiss",n=jQuery('<a class="close" href="#">'+i+"</a>");return n.bind("click.pointer",function(e){e.preventDefault(),t.element.pointer("close")})},close:function(){jQuery.post(window.ajaxurl,{field:e.field,value:e.value,action:e.action,_wpnonce:e.nonce})}}).pointer("open")},window.ms_init.view_membership_overview=function(){var e=jQuery(".membership-description"),t=e.find(".show-editor"),i=e.find(".readonly"),n=e.find(".editor"),r=n.find("textarea");jQuery(".wpmui-radio-slider").on("wpmui-radio-slider-updated",function(){var e=this,t=jQuery("#ms-membership-status");jQuery(e).hasClass("on")?t.addClass("ms-active"):t.removeClass("ms-active")}),t.click(function(){i.addClass("hidden"),n.removeClass("hidden"),r.focus().data("dirty",!1)}),r.change(function(){r.data("dirty",!0)}).blur(function(){return r.data("dirty")===!0?!1:(i.removeClass("hidden"),n.addClass("hidden"),void 0)}).on("ms-ajax-updated",function(e,t,a,s){var o=r.val();return s?!1:(i.find(".value").html(o),i.removeClass("hidden"),n.addClass("hidden"),n.find(".okay, .error").removeClass("okay error"),o.length?i.find(".empty").addClass("hidden"):i.find(".empty").removeClass("hidden"),void 0)})},window.ms_init.view_membership_setup_payment=function(){function e(){var e=jQuery(this),t=e.closest(".inside"),i=e.val(),n=t.find(".ms-payment-type-wrapper"),r=t.find(".ms-payment-type-"+i),a=t.find(".ms-after-end-wrapper");n.hide(),r.show(),"permanent"===i?a.hide():a.show()}function t(){var e=jQuery(".ms-payments-choice").hasClass("on"),t=jQuery("#ms-payment-settings-wrapper");e?t.show():t.hide()}function i(){var e=jQuery(this).val(),t=jQuery(".ms-payment-structure-wrapper");switch(e){case"USD":e="$";break;case"EUR":e="&euro;";break;case"JPY":e="&yen;"}t.find(".wpmui-field-description").html(e)}jQuery(".ms-payment-type").change(e),jQuery(".ms-payment-type").each(e),jQuery(".ms-payments-choice").change(t),t(),jQuery("#currency").change(i)},window.ms_init.view_settings=function(){function e(){var e=jQuery("select.wpmui-wp-pages"),t=e.map(function(){return jQuery(this).val()});e.each(function(){var e,i=jQuery(this),n=i.find("option"),r=i.parents(".ms-settings-page-wrapper").first(),a=r.find(".ms-action a"),s=i.val();for(n.prop("disabled",!1),e=0;t.length>e;e+=1)s!==t[e]&&n.filter('[value="'+t[e]+'"]').prop("disabled",!0);a.each(function(){var e=jQuery(this),t=e.data("ajax"),i=t.base+s;void 0===s||isNaN(s)||1>s?(e.addClass("disabled"),e.attr("href","")):(e.removeClass("disabled"),e.attr("href",i))})})}function t(e){var t=jQuery(this);return t.hasClass("disabled")||!t.attr("href").length?(e.preventDefault(),!1):void 0}function i(){jQuery("#ms-comm-type-form").submit()}function n(){window.location=ms_data.initial_url}function r(e,t){t.value?(jQuery("#wp-admin-bar-ms-unprotected").hide(),jQuery("#wp-admin-bar-ms-test-memberships").show()):(jQuery("#wp-admin-bar-ms-unprotected").show(),jQuery("#wp-admin-bar-ms-test-memberships").hide())}jQuery("#initial_setup").on("ms-ajax-updated",n),jQuery(".wpmui-slider-plugin_enabled").on("wpmui-radio-slider-updated",r),jQuery(".wpmui-wp-pages").on("ms-ajax-updated",e),jQuery(".ms-action a").on("click",t),jQuery(function(){e()}),jQuery("#comm_type").change(i)},window.ms_init.view_addons=function(){function e(e,t,i){switch(t){case"options":i.hide().filter(".ms-options").show()}}jQuery(document).on("list-filter",e)},window.ms_init.view_settings_automated_msg=function(){var e=!1;jQuery("#switch_comm_type").click(function(){var t=jQuery(this),i=t.closest("form"),n=0;for(n=0;window.tinymce.editors.length>n;n+=1)if(window.tinymce.editors[n].isDirty()){e=!0;break}return e&&!window.confirm(ms_data.lang_confirm)?!1:(i.submit(),void 0)}),jQuery("input, select, textarea",".ms-editor-form").change(function(){e=!0}),window.tinymce.PluginManager.add("ms_variable",function(e){function t(){e.insertContent(this.value())}var i,n,r=[];for(i in ms_data.var_button.items)ms_data.var_button.items.hasOwnProperty(i)&&(n=ms_data.var_button.items[i],r.push({text:n,value:i,onclick:t}));e.addButton("ms_variable",{text:ms_data.var_button.title,icon:!1,type:"menubutton",menu:r})})},window.ms_init.view_settings_mailchimp=function(){jQuery("#mailchimp_api_key").on("ms-ajax-updated",ms_functions.reload)},window.ms_init.view_settings_payment=function(){function e(e,t,i,n,r){var a=jQuery(".gateway-"+r.gateway_id);n||(a.removeClass("not-configured").addClass("is-configured"),void 0!==r.mode&&"sandbox"===r.mode?a.removeClass("is-live").addClass("is-sandbox"):a.removeClass("is-sandbox").addClass("is-live"))}jQuery(document).on("ms-ajax-form-done",e)},window.ms_init.view_settings_protection=function(){function e(e){var t=jQuery("#"+e.type),i=t.closest(".wp-editor-wrap"),n=window.tinyMCE.get(e.type);return n&&i.hasClass("tmce-active")&&n.save(),e.value=t.val(),e}jQuery(".button-primary.wpmui-ajax-update").data("before_ajax",e)};